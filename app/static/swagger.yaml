swagger: "2.0"
info:
  version: "1.0.0"
  title: "Mechanic Shop API v1"
  description: "API for managing customers, mechanics, service tickets, and inventory in a mechanic shop."
basePath: "https://mechanicshop-v1-1.onrender.com"
schemes:
  - "https"

definitions:
  Customer:
    type: object
    required: ["name", "email", "phone", "password"]
    properties:
      id:
        type: integer
      name:
        type: string
      email:
        type: string
      phone:
        type: string
      password:
        type: string

  CustomerUpdate:
    type: object
    properties:
      name:
        type: string
      email:
        type: string
      phone:
        type: string
      password:
        type: string

  Mechanic:
    type: object
    required: ["name", "email", "phone", "password", "salary"]
    properties:
      id:
        type: integer
      name:
        type: string
      email:
        type: string
      phone:
        type: string
      password:
        type: string
      salary:
        type: integer

  MechanicUpdate:
    type: object
    properties:
      name:
        type: string
      email:
        type: string
      phone:
        type: string
      password:
        type: string
      salary:
        type: integer

  Inventory:
    type: object
    required: ["name", "price"]
    properties:
      id:
        type: integer
      name:
        type: string
      price:
        type: number
        format: float

  InventoryUpdate:
    type: object
    properties:
      name:
        type: string
      price:
        type: number
        format: float

  ServiceTicket:
    type: object
    required: ["customer_id", "mechanic_id", "Date", "service_description"]
    properties:
      id:
        type: integer
      customer_id:
        type: integer
      mechanic_id:
        type: integer
      Date:
        type: string
        format: date-time
      service_description:
        type: string
      mechanics:
        type: array
        items:
          $ref: "#/definitions/Mechanic"
      items:
        type: array
        items:
          $ref: "#/definitions/Inventory"

  ServiceTicketShort:
    type: object
    properties:
      ticket_id:
        type: integer
      date:
        type: string
        format: date-time
      service_description:
        type: string

  EditTicket:
    type: object
    properties:
      add_mechanic_ids:
        type: array
        items:
          type: integer
      remove_mechanic_ids:
        type: array
        items:
          type: integer
      add_item:
        type: array
        items:
          type: integer
      remove_item:
        type: array
        items:
          type: integer

  Login:
    type: object
    required: ["email", "password"]
    properties:
      email:
        type: string
      password:
        type: string

paths:
  /customers:
    post:
      summary: Create Customer
      consumes:
        - application/json
      parameters:
        - in: body
          name: body
          required: true
          schema:
            $ref: "#/definitions/Customer"
      responses:
        "201":
          description: Created
          schema:
            $ref: "#/definitions/Customer"
        "400":
          description: Validation error
    get:
      summary: Get All Customers
      responses:
        "200":
          description: OK
          schema:
            type: array
            items:
              $ref: "#/definitions/Customer"

  /customers/login:
    post:
      summary: Customer Login
      consumes:
        - application/json
      parameters:
        - in: body
          name: body
          required: true
          schema:
            $ref: "#/definitions/Login"
      responses:
        "200":
          description: Token returned
          schema:
            type: object
            properties:
              token:
                type: string
        "400":
          description: Bad request

  /customers/{customer_id}:
    get:
      summary: Get Customer by ID
      parameters:
        - name: customer_id
          in: path
          required: true
          type: integer
      responses:
        "200":
          description: OK
          schema:
            $ref: "#/definitions/Customer"
        "404":
          description: Not found
    put:
      summary: Update Customer
      parameters:
        - name: customer_id
          in: path
          required: true
          type: integer
        - in: body
          name: body
          required: true
          schema:
            $ref: "#/definitions/CustomerUpdate"
      responses:
        "200":
          description: Updated
          schema:
            $ref: "#/definitions/Customer"
        "403":
          description: Unauthorized
    delete:
      summary: Delete Customer
      parameters:
        - name: customer_id
          in: path
          required: true
          type: integer
      responses:
        "200":
          description: Deleted
        "404":
          description: Not found

  /customers/service-tickets:
    get:
      summary: Get Customer Service Tickets
      responses:
        "200":
          description: List of service tickets for the authenticated customer
          schema:
            type: object
            properties:
              customer_id:
                type: integer
              service_tickets:
                type: array
                items:
                  $ref: "#/definitions/ServiceTicketShort"

  /mechanics:
    post:
      summary: Create Mechanic
      consumes:
        - application/json
      parameters:
        - in: body
          name: body
          required: true
          schema:
            $ref: "#/definitions/Mechanic"
      responses:
        "201":
          description: Created
          schema:
            $ref: "#/definitions/Mechanic"
        "400":
          description: Bad request
    get:
      summary: Get All Mechanics
      responses:
        "200":
          description: OK
          schema:
            type: array
            items:
              $ref: "#/definitions/Mechanic"

  /mechanics/{mechanic_id}:
    get:
      summary: Get Mechanic by ID
      parameters:
        - name: mechanic_id
          in: path
          required: true
          type: integer
      responses:
        "200":
          description: OK
          schema:
            $ref: "#/definitions/Mechanic"
        "404":
          description: Not found
    put:
      summary: Update Mechanic
      parameters:
        - name: mechanic_id
          in: path
          required: true
          type: integer
        - in: body
          name: body
          required: true
          schema:
            $ref: "#/definitions/MechanicUpdate"
      responses:
        "200":
          description: Updated
          schema:
            $ref: "#/definitions/Mechanic"
    delete:
      summary: Delete Mechanic
      parameters:
        - name: mechanic_id
          in: path
          required: true
          type: integer
      responses:
        "200":
          description: Deleted
        "404":
          description: Not found

  /mechanics/popular:
    get:
      summary: Get Most Active Mechanics
      responses:
        "200":
          description: OK
          schema:
            type: array
            items:
              $ref: "#/definitions/Mechanic"

  /service_tickets:
    post:
      summary: Create Service Ticket
      consumes:
        - application/json
      parameters:
        - in: body
          name: body
          required: true
          schema:
            $ref: "#/definitions/ServiceTicket"
      responses:
        "201":
          description: Created
          schema:
            $ref: "#/definitions/ServiceTicket"
        "400":
          description: Validation error
    get:
      summary: Get All Service Tickets
      responses:
        "200":
          description: OK
          schema:
            type: array
            items:
              $ref: "#/definitions/ServiceTicket"

  /service_tickets/{ticket_id}:
    get:
      summary: Get Service Ticket by ID
      parameters:
        - name: ticket_id
          in: path
          required: true
          type: integer
      responses:
        "200":
          description: OK
          schema:
            $ref: "#/definitions/ServiceTicket"
        "404":
          description: Not found
    delete:
      summary: Delete Service Ticket
      parameters:
        - name: ticket_id
          in: path
          required: true
          type: integer
      responses:
        "200":
          description: Deleted
        "404":
          description: Not found
    put:
      summary: Edit Service Ticket (add/remove mechanics & items)
      consumes:
        - application/json
      parameters:
        - name: ticket_id
          in: path
          required: true
          type: integer
        - in: body
          name: body
          required: true
          schema:
            $ref: "#/definitions/EditTicket"
      responses:
        "200":
          description: Updated
          schema:
            $ref: "#/definitions/ServiceTicket"

  /service_tickets/{ticket_id}/add_mechanic/{mechanic_id}:
    put:
      summary: Add Mechanic to Ticket
      parameters:
        - name: ticket_id
          in: path
          required: true
          type: integer
        - name: mechanic_id
          in: path
          required: true
          type: integer
      responses:
        "200":
          description: Mechanic added
          schema:
            $ref: "#/definitions/ServiceTicket"
        "400":
          description: Invalid

  /service_tickets/{ticket_id}/remove_mechanic/{mechanic_id}:
    put:
      summary: Remove Mechanic from Ticket
      parameters:
        - name: ticket_id
          in: path
          required: true
          type: integer
        - name: mechanic_id
          in: path
          required: true
          type: integer
      responses:
        "200":
          description: Mechanic removed
          schema:
            $ref: "#/definitions/ServiceTicket"
        "400":
          description: Invalid

  /inventory:
    post:
      summary: Create Inventory Item
      consumes:
        - application/json
      parameters:
        - in: body
          name: body
          required: true
          schema:
            $ref: "#/definitions/Inventory"
      responses:
        "201":
          description: Created
          schema:
            $ref: "#/definitions/Inventory"
    get:
      summary: Get All Inventory Items
      responses:
        "200":
          description: OK
          schema:
            type: array
            items:
              $ref: "#/definitions/Inventory"

  /inventory/{item_id}:
    get:
      summary: Get Inventory Item by ID
      parameters:
        - name: item_id
          in: path
          required: true
          type: integer
      responses:
        "200":
          description: OK
          schema:
            $ref: "#/definitions/Inventory"
        "404":
          description: Not found
    put:
      summary: Update Inventory Item
      parameters:
        - name: item_id
          in: path
          required: true
          type: integer
        - in: body
          name: body
          required: true
          schema:
            $ref: "#/definitions/InventoryUpdate"
      responses:
        "200":
          description: Updated
          schema:
            $ref: "#/definitions/Inventory"
    delete:
      summary: Delete Inventory Item
      parameters:
        - name: item_id
          in: path
          required: true
          type: integer
      responses:
        "200":
          description: Deleted
        "404":
          description: Not found
